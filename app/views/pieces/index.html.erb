<h1>ピース集めの旅 ホーム</h1>
<p>すれ違った人からピースを集め, 筑波大学を完成させよう！</p>

<% if User.find_by(id: current_user.id).pieces.empty? %>
  <% new_piece = Piece.all.sample(1).first %>
  <h4>最初のピース「<%= new_piece.name %>」をゲットしました！</h4>
  <% UserPiece.create(user_id: current_user.id, piece_id: new_piece.id) %>
  <% @pieces = [new_piece] %>
<% end %>

<% @users.each do |user| %>
  <div>
    <%= link_to piece_path(user) do %>
      <% if user.profile_image? %>
        <img src="<%= user.profile_image.url %>" height=150 width=150 alt="<%= user.name %>'s profile image" />
      <% else %>
        <img src="/assets/default.png" height=150 width=150 alt="<%= user.name %>'s profile image" />
      <% end %>
      <div><%= user.name %></div>
    <% end %>
  </div>
<% end %>

<% console %>

<div class="map" id="map" data-controller="map" data-map-pieces="<%= @pieces.to_json %>" ></div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAToqnvm_22X0zWbCJfoRyuOLg94PLYLR8&callback=initMap" async defer></script>
